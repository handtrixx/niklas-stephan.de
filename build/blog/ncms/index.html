<!doctype html><html lang=de dir=ltr data-ui-theme=light><head><style>:root,[data-ui-theme=light]{--spacing-unit:0.25rem;--font-size:16px;--color-primary-r:184;--color-primary-g:5;--color-primary-b:5;--color-primary:rgb(var(--color-primary-r), var(--color-primary-g), var(--color-primary-b));--color-primary-hex:#b80505;--color-secondary:#79747E;--color-light:#f8f1f6;--color-lighter:#fefbff;--color-dark:#1c1b1d;--color-darker:#141314;--color-gray:#9E9E9E;--color-darkgray:#3a3a3a;--color-shadow:rgba(0, 0, 0, 0.3)}:root[data-ui-theme=dark]{--color-light:#1c1b1d;--color-lighter:#141314;--color-dark:#f8f1f6;--color-darker:#fefbff;--color-shadow:rgba(0, 0, 0, 0.5)}</style><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Noch ein Web Content Management System?! Ich stelle vor: nCMS | niklas-stephan.de</title><link rel=icon href=/images/favicon.png type=image/png><link rel=stylesheet href=/css/combined.min.9ccbf8dc69756f4bae3d2dbd047f43f9a71599e9f711b5c9681d1a673f415c38.css integrity="sha256-nMv43Gl1b0uuPS29BH9D+acVmen3EbXJaB0aZz9BXDg="><meta name=description content="Warum sollte man sein eigenes Web Content Management System (WCMS) erstellen wollen, es gibt doch schon hunderte?!
Völlig korrekt und es gibt auch keinen wirklichen Grund so etwas zeitintensives zu tun,
außer natürlich man ist mit dem was es gibt nicht so richtig zufrieden und/oder möchte
einfach selber wissen und ausprobieren wie man so etwas angehen kann.
Genau mit dieser Motivation, und der ursprünglichen Intention für meine persönliche
Website ein neues Layout zu entwickeln, habe ich mir innerhalb eines Monats ein eigenes WCMS erstellt:
nCMS – “niklas stephan’s Content Management System” oder auch “node-red Content Management System”
oder “not another Content Management System”!"><meta property="og:title" content="Noch ein Web Content Management System?! Ich stelle vor: nCMS"><meta property="og:description" content="Warum sollte man sein eigenes Web Content Management System (WCMS) erstellen wollen, es gibt doch schon hunderte?!
Völlig korrekt und es gibt auch keinen wirklichen Grund so etwas zeitintensives zu tun,
außer natürlich man ist mit dem was es gibt nicht so richtig zufrieden und/oder möchte
einfach selber wissen und ausprobieren wie man so etwas angehen kann.
Genau mit dieser Motivation, und der ursprünglichen Intention für meine persönliche
Website ein neues Layout zu entwickeln, habe ich mir innerhalb eines Monats ein eigenes WCMS erstellt:
nCMS – “niklas stephan’s Content Management System” oder auch “node-red Content Management System”
oder “not another Content Management System”!"><meta property="og:type" content="article"><meta property="og:url" content="https://niklas-stephan.de/blog/ncms/"><meta property="og:site_name" content="niklas-stephan.de"><meta property="og:image" content="https://niklas-stephan.de/blog/ncms/01_ncms_logo.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Noch ein Web Content Management System?! Ich stelle vor: nCMS"><meta name=twitter:description content="Warum sollte man sein eigenes Web Content Management System (WCMS) erstellen wollen, es gibt doch schon hunderte?!
Völlig korrekt und es gibt auch keinen wirklichen Grund so etwas zeitintensives zu tun,
außer natürlich man ist mit dem was es gibt nicht so richtig zufrieden und/oder möchte
einfach selber wissen und ausprobieren wie man so etwas angehen kann.
Genau mit dieser Motivation, und der ursprünglichen Intention für meine persönliche
Website ein neues Layout zu entwickeln, habe ich mir innerhalb eines Monats ein eigenes WCMS erstellt:
nCMS – “niklas stephan’s Content Management System” oder auch “node-red Content Management System”
oder “not another Content Management System”!"><meta name=twitter:image content="https://niklas-stephan.de/blog/ncms/01_ncms_logo.webp"></head><body><div class=nav-wrapper><div class=nav-bar><a href=/ aria-label="Link to Homepage" class=nav-link><img src=/images/favicon.png alt=favicon width=30 height=30>
<span class="text-fingerpaint d-none d-sm-flex">iklas-stephan.de</span></a><div class="d-none d-md-flex"><a class=nav-link href=/ aria-label=Home>Home</a>
<a class=nav-link href=/blog aria-label=Blog>Blog</a></div><div class=d-flex><a href=/search type=button aria-label="Search Button" class="nav-link btn btn-circle-text-small"><svg width="24" height="24" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
</a><button id=themeswitch role=button aria-label="Theme Switch Button" onclick=themeswitch() class="btn btn-circle-text-small">
<svg width="24" height="24" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.77.77.0 01.08.858 7.2 7.2.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79.0 01.81.316.73.73.0 01-.031.893A8.35 8.35.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.75.75.0 016 .278"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.73 1.73.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.73 1.73.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.73 1.73.0 001.097-1.097zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.16 1.16.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.16 1.16.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732z"/></svg>
</button>
<button id=fontsmaller role=button aria-label="Font Switch smaller Button" onclick='fontswitch("smaller")' class="btn btn-circle-text-small">
<svg width="24" height="24" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 8a.5.5.0 01.5-.5h11a.5.5.0 010 1h-11A.5.5.0 012 8"/></svg>
</button>
<button id=fontreset role=button aria-label="Font Switch reset Button" onclick='fontswitch("reset")' class="btn btn-circle-text-small">
<svg width="24" height="24" fill="currentColor" class="bi bi-fonts" viewBox="0 0 16 16"><path d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479z"/></svg>
</button>
<button id=fontbigger role=button aria-label="Font Switch bigger Button" onclick='fontswitch("bigger")' class="btn btn-circle-text-small">
<svg width="24" height="24" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 2a.5.5.0 01.5.5v5h5a.5.5.0 010 1h-5v5a.5.5.0 01-1 0v-5h-5a.5.5.0 010-1h5v-5A.5.5.0 018 2"/></svg></button><div class="dropdown d-md-none" style=float:right><button class="btn btn-circle-text-small" onclick=toggleDropdown(this) aria-expanded=false>
<svg width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"/></svg></button><div class=dropdown-content style=display:none><a href=/ aria-label=Home>Home</a>
<a href=/blog aria-label=Blog>Blog</a></div></div></div></div></div><main><div id=page-assitant-toggler class="position-fixed bottom-0 right-0"><button type=button class="btn btn-circle p mb me" onclick=togglePostNav() alt=Einstellungen style=--p-scale:0;--mb-scale:4;--me-scale:4>
<svg width="24" height="24" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16"><path d="M8 4.754a3.246 3.246.0 100 6.492 3.246 3.246.0 000-6.492M5.754 8a2.246 2.246.0 114.492.0A2.246 2.246.0 015.754 8"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592.0l-.094.319a.873.873.0 01-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873.0 01-.52 1.255l-.319.094c-1.79.527-1.79 3.065.0 3.592l.319.094a.873.873.0 01.52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873.0 011.255.52l.094.319c.527 1.79 3.065 1.79 3.592.0l.094-.319a.873.873.0 011.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873.0 01.52-1.255l.319-.094c1.79-.527 1.79-3.065.0-3.592l-.319-.094a.873.873.0 01-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873.0 01-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674.0l.094.319a1.873 1.873.0 002.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873.0 001.116 2.692l.318.094c.835.246.835 1.428.0 1.674l-.319.094a1.873 1.873.0 00-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873.0 00-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674.0l-.094-.319A1.873 1.873.0 004.377 12.94l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873.0 001.945 8.93l-.319-.094c-.835-.246-.835-1.428.0-1.674l.319-.094A1.873 1.873.0 003.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873.0 002.692-1.115z"/></svg></button></div><div class="block-post-nav d-none" id=block-post-nav><div class="p pt w-100" style=--p-scale:2;--pt-scale:5><div class="d-flex justify-content-center align-items-center"><h5 class=mb style=align-self:center;--mb-scale:0>Konfiguration</h5><button class="ms-auto btn-circle-text-small" onclick=togglePostNav() aria-label="Close navigation">
<svg width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5.0 11.708-.708L8 7.293l5.146-5.147a.5.5.0 01.708.708L8.707 8l5.147 5.146a.5.5.0 01-.708.708L8 8.707l-5.146 5.147a.5.5.0 01-.708-.708L7.293 8z"/></svg></button></div><hr class=my style=--my-scale:4><h6>Inhalt</h6><ul class=content-index-list id=content-index-list><li class="content-index-item active" onclick=scrollToTop()>Anfang</li></ul></div></div><div class=post-container><nav aria-label=breadcrumb><ul class=breadcrumb><li class=breadcrumb-item><a href=/blog>Blog</a></li><svg width="16" height="16" fill="currentColor" class="bi bi-chevron-right mx" style="--mx-scale:2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708"/></svg><li class="breadcrumb-item active" aria-current=page>Beitrag</li></ul></nav><h1 class=fs style=--fs-scale:3>Noch ein Web Content Management System?! Ich stelle vor: nCMS</h1><div class="post-meta mb-4"><time datetime=2023-03-05>5. March 2023</time><div class="tags mt-2"><span class="badge bg-secondary me-1">deutsch</span></div></div><p>Warum sollte man sein eigenes Web Content Management System (WCMS) erstellen wollen, es gibt doch schon hunderte?!
Völlig korrekt und es gibt auch keinen wirklichen Grund so etwas zeitintensives zu tun,
außer natürlich man ist mit dem was es gibt nicht so richtig zufrieden und/oder möchte
einfach selber wissen und ausprobieren wie man so etwas angehen kann.
Genau mit dieser Motivation, und der ursprünglichen Intention für meine persönliche
Website ein neues Layout zu entwickeln, habe ich mir innerhalb eines Monats ein eigenes WCMS erstellt:
nCMS – “niklas stephan’s Content Management System” oder auch “node-red Content Management System”
oder “not another Content Management System”!</p><p><img src=02_ncms_logo_small.webp alt="Logo klein"></p><h2 id=was-ist-ncms-und-was-kann-es>Was ist nCMS und was kann es?</h2><p>nCMS ist ein Flat-File und Headless Web Content Management System. D.h. im Gegensatz zu z.B. zu WordPress,
kommt es ohne eine Datenbank aus und besteht aus Dateien. NCMS basiert im Backend auf Node-Red
und darin entwickelten Node.js JavaScript Funktionen.</p><p>Änderungen am Code von NCMS werden durch Deployments in Node-Red geschrieben und die Änderungen an
Dateien über GIT in Github synchronisiert und versioniert. Änderungen an Inhalten wie neue
Posts werden ebenfalls über Deployments, manuell oder als Webhook gestartet. Alle Dateien werden darauf
hin generiert und einem Webserver als statische Dateien zur Verfügung gestellt. Das heisst dass der
Abruf der Inhate über eine mit nCMS erstellte Website rasend schnell ist. Das erstellen einzelner
Blog Beiträge erfolgt in Markup Syntax in einem beliebigem Texteditor.</p><p>Weitere bis jetzt integrierte Features sind:</p><ul><li>Multi-Language Support für Blog Beiträge und alle Seiten</li><li>Kommentarfunktion in den Blogbeiträgen</li><li>Media Management über einfachen Datei-Upload</li><li>Template- und Snippet-basierte Erstellung des HTML Gerüsts</li><li>Explizit kein Einsatz von Frontend Frameworks wie Vue oder Angular, sondern reines “Vanilla” Javascript.</li><li>Automatische Generierung von Meta-Daten für Social Media Integration und SEO</li><li>Volltextsuche auf Basis eines automatisch generierten lokalen Index</li><li>Freigabefunktion von Posts über ein “published” Attribut</li></ul><p>Und viele mehr, dokumentiert im GitHub Repository des Projekts: <a href=https://github.com/handtrixx/ncms>https://github.com/handtrixx/ncms</a></p><h2 id=schneller-aufgeräumter-und-einfacher-als-wordpress-und-andere>Schneller, aufgeräumter und einfacher als WordPress und andere?</h2><p>Ja, ja, ja. Wie genau, erläutere ich hier.</p><h3 id=schnell>Schnell</h3><p>Im Backend – Ein Deployment (erzeugen der statischen Files für den Webserver) dauert zwischen 70 und 320 Millisekunden.</p><p><img src=03_ncms_deployment.webp alt=Deployment></p><p>Im Frontend – z.B. die Startseite ist trotz aller Animationen, Effekte und Bilder nur 670KB groß und kann in zwischen 100 und 300 Millisekunden
vom Client vollständig geladen werden.</p><p><img src=04_ncms_pageload.webp alt="Page Load"></p><h3 id=aufgeräumt>Aufgeräumt</h3><p>Im Backend: Der Einsatz von Node-Red gibt eine grafische Übersicht und gewährleistet so, dass wir den Überblick nicht verlieren.
Dazu später noch mehr.</p><p><img src=05_ncms_node-red-flow.webp alt=Flow></p><p>Im Frontend: Durch den Verzicht auf JavaScript Frameworks und der Einfachheit des Systems an sich,
werden wir mit sauberen HTML Code bei der Ausspielung belohnt. Für <a href=https://niklas-stephan.de>https://niklas-stephan.de</a>
habe ich zwar für das Frontend UI auf das HTML5 Grundgerüst von Bootstrap 5 zurück gegriffen,
aber das fällt nicht mehr schwer ins Gewicht, und kommt mittlerweile
im Standard ebenfalls ohne das aufgeblähte jQuery Framework zurecht.</p><p><img src=06_ncms_lighthouse.webp alt=Lighthouse></p><h3 id=einfach>Einfach</h3><p>Im Backend: Assets, Medien, Templates und Snippets werden über Visual Studio Code oder
einen anderen Texteditor + Dateimanager bereitgestellt. In Node-Red wird das alles zusammengefügt,
durch JavaScript Code und node.js Module um Funktionalitäten erweitert und das Endergebnis
schließlich in Form von statischen Dateien in ein Verzeichnis auf einem nginx webserver zur
Verfügung gestellt. Das ist der Kern von nCMS.</p><p><img src=07_ncms_logo-1.webp alt=Logo></p><p>Im Frontend: Frontend: Die Wahl zwischen Deutsch und Englisch erfolgt entweder automatisch oder
wird manuell festegelegt. Es gibt eine Startseite, eine Seite zu Suche,
eine Seite zu Datenschutz und Impressum, eine Seite zum abfangen ungültiger
Aufrufe und eine Seite mit der Übersicht über alle Posts. Selsbstredend ist das komplette UI auf alle Endgerätearten zur Darstellung optimiert.</p><h2 id=hinter-den-kulissen>Hinter den Kulissen</h2><p>Der komplette Aufbau von nCMS erfolgt in einer Docker-Compose Umgebung.
Alle Dateien aus dem Volume <code>src</code> liegen ebenfalls auf <a href=https://github.com/handtrixx/ncms>https://github.com/handtrixx/ncms</a>.</p><p>Hier meine Beispielkonfiguration auf Basis des offiziellen Node-Red Images von
Docker Hub (<a href=https://hub.docker.com/r/nodered/node-red)>https://hub.docker.com/r/nodered/node-red)</a>:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#7ee787>services</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#6e7681>  </span><span style=color:#7ee787>ncms</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>container_name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ncms</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>hostname</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ncms</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>image</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nodered/node-red:latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>restart</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>always</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>environment</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>TZ=Europe/Berlin</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>networks</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>dmz</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>logging</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span><span style=color:#6e7681>      </span><span style=color:#7ee787>options</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#6e7681>        </span><span style=color:#7ee787>max-size</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;10m&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span><span style=color:#6e7681>        </span><span style=color:#7ee787>max-file</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;3&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>volumes</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>./data:/data</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>./dist:/dist:rw</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>./src:/src:rw</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>/etc/localtime:/etc/localtime:ro</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span><span style=color:#6e7681></span><span style=color:#7ee787>networks</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span><span style=color:#6e7681>  </span><span style=color:#7ee787>dmz</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span><span style=color:#6e7681>    </span><span style=color:#7ee787>external</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>Erkärungsbedürftig sind hier eigentlich nur die Netzwerkonfiguration und die verschiedenen Volumes.
Wie auch in meinen anderen Beiträgen zu Matomo, Boinc und anderen setze ich auf meinem Cloud Server einen Reverse Proxy
auf Basis des Nginx Proxy Managers (<a href=https://hub.docker.com/r/jc21/nginx-proxy-manager>https://hub.docker.com/r/jc21/nginx-proxy-manager</a>) ein. Das Volume/Verzeichnis <code>./dist</code>ist in
meinem Reverse Proxy ebenfalls über ein ln -s verlinkt, so dass man keine doppelten Deployments machen
muss und ein weiterer Webserver obsolet bleibt. Node-Red selbst, also das Backend ist über eine eigene Subdomain erreichbar.</p><h3 id=verzeichnisstruktur>Verzeichnisstruktur</h3><p>Im Verzeichnis <code>./src</code> befinden sich folgende Unterordner:</p><ul><li>assets<ul><li>css</li><li>fonts</li><li>img</li><li>js</li><li>json</li></ul></li><li>md<ul><li>posts</li></ul></li><li>media<ul><li>x</li></ul></li><li>snippets</li><li>templates</li></ul><p>In das Verzeichnis assets und dessen Unterordner gehören alle im Frontend wiederholt benötigten Dateien,
wie z.B. css und javascript von Bootstrap 5 (<a href=https://getbootstrap.com/)>https://getbootstrap.com/)</a>,
aber natürlich vor allem auch eigene Stylesheets und Javascript Funktionen.
Im Unterordner json legen wir unsere statischen Übersetzungschlüssel ab.</p><p>Der Ordner md enthält in seinem Unterordner posts offensichtlich alle unsere
in Markup geschriebenen Posts, welche auch an ihrer Dateiendung .md erkennbar sind.</p><p>In das Verzechnis media und maximal eine Unterodnerebene tiefer können wir alle Bilder “werfen”
die wir in unseren Posts verwenden wollen. Diese werden dann während des Deployments automatisch
ins platzsparende .webp Format konvertiert und ein Thumbnail für jedes Bild generiert.</p><p>Im Ordner snippteshaben wir alle HTML Elemente die wir auf allen Seiten immer wieder benötigen gelegt.</p><p>Analog dazu liegen im Verzeichnis templates die Ausgangsdateien unseres Frontends,
die während des Deployments mit Inhalt angereichtert werden.</p><p>All das lässt sich Transparent auch im Github Projekt unter: <a href=https://github.com/handtrixx/ncms>https://github.com/handtrixx/ncms</a> nachvollziehen.</p><h3 id=templates>Templates</h3><p>Im Verzeichnis Templates befinden sich folgende Dateien: 404.html – Die Fehlerseite die immer dann angezeigt wird,
wenn eine ungültige Abfrage auf die Website erfolgt. blog.html – Die Seite die die Übersicht über alle Posts bereit stellt.
index.html – Die Startseite mit ihren Inhalten. post.html –
Die Vorlage aus der die einzelen Beitragsseiten gerendert werden. privacy-policy.html –
Die Seite zu Datenschutz und im Impressum auf die im Footer verllinkt ist und die somit
von überall aus erreichbar ist und sein muss. robots.txt – Infos für die Crawler von Suchmaschinen.
search.html – Meine Seite auf der man Suchen kann und die über einen json Index sämtliche
Suchergebnisse ohne Abfrage am Server bereitstellt.</p><h3 id=snippets>Snippets</h3><p>Die Snippets die später im Deployment in alle HTML Templates eingeschläust werden sind
footer.html, head.html, navbar.html, script.html .
Durch die Aufteilung in diese Snippets haben wir den massiven Vorteil,
dass wir im Falle einer gewünschten Anpassung z.B. im Navigationsmenü,
diese nur genau einmal durchführen müssen um sie auf allen Seiten zu ändern.</p><h2 id=programmlogik-mit-nodejs-und-node-red>Programmlogik mit node.js und Node-Red</h2><p>Node-Red basiert auf node.js und erlaubt uns in einer Art Ablaufdiagramm verschiedene Elemente
und Funktionen miteinander zu verbinden. Das nennt sich in Node-Red “Flow”.
In NCMS nutze ich auch nur diese Basisfunktionalität von Node-Red und keine weitere
Plug-Ins aus der Palette. Stattdessen lade ich in den verschiedenen Nodes node.js
Pakete nach um den Funktionsumfang des Systems zu erweitern.</p><p><img src=08_ncms_node-red-flow.webp alt=flow></p><p>Im folgenden eine Erläuterung zu den einzelen Nodes.</p><h3 id=deploy>/deploy</h3><p>Hierbei handelt sich um einen lauschenden http in Node, um den Start eines Deplyoments durch
einen Webhook zu starten. D.h. z.B. durch curl -X POST -d &lsquo;key=&mdash;-&rsquo; <a href=https://ncms.niklas-stephan.de/deploy>https://ncms.niklas-stephan.de/deploy</a>
startet man das Deployment.</p><h3 id=catch-key>catch key</h3><p>Natürlich soll nicht einfach jeder ein Deployment starten können, deshalb noch eine kleine Sicherheitsabfrage im catch key Node.</p><p>Im Node unter “Setup” wird das npm Modul fs-extra geladen und als fse bereit gestellt,
damit wir Zugriff auf das Dateisystem haben und den im Ordner
/data hinterlegten key mit dem vergleichen können, der uns für das Deployment im Webhook zur Verfügung gestellt wurde.</p><p>Die Funktion selbst sieht dann so aus:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>const</span> transferedKey <span style=color:#ff7b72;font-weight:700>=</span> msg.payload.key;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>const</span> systemKey <span style=color:#ff7b72;font-weight:700>=</span> fse.readFileSync(<span style=color:#a5d6ff>&#39;/data/deploy.key&#39;</span>, <span style=color:#a5d6ff>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>if</span> (transferedKey <span style=color:#ff7b72;font-weight:700>==</span> systemKey) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span>    msg.payload <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;Deployment Started&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span>    msg.statusCode <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>200</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>    msg.type <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;webhook&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span>    msg.starttime <span style=color:#ff7b72;font-weight:700>=</span> Date.now();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>    <span style=color:#ff7b72>return</span> [<span style=color:#79c0ff>null</span>,msg];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>    msg.payload <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;Wrong authentication!&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>    msg.statusCode <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>400</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span>    <span style=color:#ff7b72>return</span> [msg,<span style=color:#79c0ff>null</span>];  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span>}
</span></span></code></pre></div><p>Auch hat dieser Node 2 Ausgänge. Falls die beiden keys übereinstimmen wird mit
dem Deployment fortgefahren – Ausgang 2. Falls aber nicht, dann wird eine Fehlernachricht
an Ausgang 1 übergeben und das Deployment damit abgebrochen.</p><h3 id=deploy-1>deploy</h3><p>Startet das Deployment ebenfalls, aber eben manuell über die Node-Red Oberfläche und nicht als Webhook.</p><h3 id=get-posts>get posts</h3><p>In diesem Node laden wir den Inhalt aller Posts aus den *.md Dateien und speichern diesen als
Objekte in einem Array zu späteren Verwendung ab. Außerdem machen wir neben dem
fs-extra Modul noch intensiven Gebrauch des Moduls markdown-it und Plugins für diesen.
markdown-it (<a href=https://github.com/markdown-it/markdown-it>https://github.com/markdown-it/markdown-it</a>) hilft uns dabei den Inhalt
von Markup nach HTML zu konvertieren.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span>msg.baseurl <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;https://niklas-stephan.de&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span>msg.dist <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span>msg.posts <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>const</span> path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/src/md/posts/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#ff7b72>const</span> postfiles <span style=color:#ff7b72;font-weight:700>=</span> fse.readdirSync(path)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#ff7b72>const</span> alength <span style=color:#ff7b72;font-weight:700>=</span> postfiles.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>    <span style=color:#ff7b72>var</span> srcFile <span style=color:#ff7b72;font-weight:700>=</span> path<span style=color:#ff7b72;font-weight:700>+</span>postfiles[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>    <span style=color:#ff7b72>var</span> distFilename <span style=color:#ff7b72;font-weight:700>=</span> postfiles[i].split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;.html&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>    <span style=color:#ff7b72>var</span> srcContent <span style=color:#ff7b72;font-weight:700>=</span> fse.readFileSync(srcFile, <span style=color:#a5d6ff>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span>    <span style=color:#ff7b72>var</span> md <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> markdownIt({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span>        html<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,linkify<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,typographer<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,breaks<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span>        .use(markdownItFrontMatter, <span style=color:#ff7b72>function</span>(metainfo) {meta <span style=color:#ff7b72;font-weight:700>=</span> JSON.parse(metainfo);})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span>        .use(markdownItLinkifyImages, {target<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;_blank&#39;</span>,linkClass<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;custom-link-class&#39;</span>,imgClass<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;custom-img-class&#39;</span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span>        .use(markdownItLinkAttributes, { attrs<span style=color:#ff7b72;font-weight:700>:</span> {target<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;_blank&#34;</span>,rel<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;noopener&#34;</span>,}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>    });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span>    distContent <span style=color:#ff7b72;font-weight:700>=</span> md.render(srcContent);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span>    <span style=color:#ff7b72>let</span> data <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#34;srcFile&#34;</span><span style=color:#ff7b72;font-weight:700>:</span><span style=color:#a5d6ff>&#34;&#34;</span><span style=color:#ff7b72;font-weight:700>+</span>srcFile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;&#34;</span>,<span style=color:#a5d6ff>&#34;srcContent&#34;</span><span style=color:#ff7b72;font-weight:700>:</span><span style=color:#a5d6ff>&#34;&#34;</span><span style=color:#ff7b72;font-weight:700>+</span>srcContent<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;&#34;</span>,<span style=color:#a5d6ff>&#34;distContent&#34;</span><span style=color:#ff7b72;font-weight:700>:</span><span style=color:#a5d6ff>&#34;&#34;</span><span style=color:#ff7b72;font-weight:700>+</span>distContent<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;&#34;</span>,<span style=color:#a5d6ff>&#34;distFilename&#34;</span><span style=color:#ff7b72;font-weight:700>:</span><span style=color:#a5d6ff>&#34;&#34;</span><span style=color:#ff7b72;font-weight:700>+</span>distFilename<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;&#34;</span>,...meta};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span>    msg.posts.push(data)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">27</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=get-snippets>get snippets</h3><p>Über das npm Modul fs-extra laden wir den Inhalt unserer snippets und speichern diese als Array msg.snippets,
damit wir später im Flow darauf zugreifen können.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span>msg.snippets <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>const</span> path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/src/snippets/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#ff7b72>const</span> files <span style=color:#ff7b72;font-weight:700>=</span> fse.readdirSync(path)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>const</span> alength <span style=color:#ff7b72;font-weight:700>=</span> files.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>    <span style=color:#ff7b72>var</span> srcFile <span style=color:#ff7b72;font-weight:700>=</span> path<span style=color:#ff7b72;font-weight:700>+</span>files[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span>    <span style=color:#ff7b72>var</span> srcContent <span style=color:#ff7b72;font-weight:700>=</span> fse.readFileSync(srcFile, <span style=color:#a5d6ff>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>    msg.snippets[files[i]] <span style=color:#ff7b72;font-weight:700>=</span> srcContent;   
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=get-templates>get templates</h3><p>Genauso wie die Snippets speichern wir auch den Inhalt der Templates in unserem Flow zur späteren Verwendung.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span>msg.templates <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>const</span> path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/src/templates/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#ff7b72>const</span> files <span style=color:#ff7b72;font-weight:700>=</span> fse.readdirSync(path)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>const</span> alength <span style=color:#ff7b72;font-weight:700>=</span> files.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>    <span style=color:#ff7b72>var</span> srcFile <span style=color:#ff7b72;font-weight:700>=</span> path<span style=color:#ff7b72;font-weight:700>+</span>files[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span>    <span style=color:#ff7b72>var</span> srcContent <span style=color:#ff7b72;font-weight:700>=</span> fse.readFileSync(srcFile, <span style=color:#a5d6ff>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>    msg.templates[files[i]] <span style=color:#ff7b72;font-weight:700>=</span> srcContent;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-indexhtml>create index.html</h3><p>Nun fangen wir an die Inhalte der einzelnen Dateien zu generieren, den Start macht unsere index.html Datei.
Die obere Hälfte des Codes betrifft das generieren der Meta Tags für Social Media und Suchmaschinen.
Im zweiten Block fügen wir in die Platzhalter des Templates die Werte Snippets, den Seitentitel, sowie die Metadaten ein.
Letztlich steht unsere fertige index.html als Objekt msg.dist.index in unserem Flow bereit um später als Datei geschrieben zu werden.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>var</span> ogmetalang <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;de_DE&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#ff7b72>var</span> ogmeta <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:type&#34; content=&#34;website&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:locale&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>ogmetalang<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:site_name&#34; content=&#34;niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span><span style=color:#a5d6ff>&lt;link rel=&#34;canonical&#34; href=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/index.html&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:title&#34; content=&#34;Projects &amp; Blog - niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/index.html&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:image:secure_url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:card&#34; content=&#34;summary&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:title&#34; content=&#34;Projects &amp; Blog - niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.templates[<span style=color:#a5d6ff>&#34;index.html&#34;</span>].replace(<span style=color:#a5d6ff>&#34;&lt;!-- html head from head.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;head.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.index.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Top Navigation from navbar.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;navbar.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.index.replace(<span style=color:#a5d6ff>&#34;&lt;!-- footer navigation from footer.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;footer.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.index.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Javascript from script.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;script.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.index.replace(<span style=color:#a5d6ff>&#34;&lt;!-- PAGE TITLE --&gt;&#34;</span>,<span style=color:#a5d6ff>&#34;Home&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span>msg.dist.index <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.index.replace(<span style=color:#a5d6ff>&#34;&lt;!-- meta tags --&gt;&#34;</span>,ogmeta);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-404html>create 404.html</h3><p>Die 404.html ist schnell zusammen gebaut. wir fügen alle Snippets in unser Template ein und geben der Seite einen Namen.
Abschließend steht unser Objekt als msg.dist.errorpage zur Verfügung.</p><h3 id=create-privacy-policyhtml>create privacy-policy.html</h3><p>Genauso ein “Low-Brainer” ist die Seite mit Datenschutz und Impressum und schnell als msg.dist.privacy aufbereitet.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">1</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">3</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> msg.templates[<span style=color:#a5d6ff>&#34;privacy-policy.html&#34;</span>].replace(<span style=color:#a5d6ff>&#34;&lt;!-- html head from head.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;head.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">4</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.privacy.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Top Navigation from navbar.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;navbar.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">5</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.privacy.replace(<span style=color:#a5d6ff>&#34;&lt;!-- footer navigation from footer.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;footer.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">6</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.privacy.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Javascript from script.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;script.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">7</span><span>msg.dist.privacy <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.privacy.replace(<span style=color:#a5d6ff>&#34;&lt;!-- PAGE TITLE --&gt;&#34;</span>,<span style=color:#a5d6ff>&#34;Datenschutz &amp; Impressum&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">9</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-searchhtml>create search.html</h3><p>Bevor es wieder ein wenig komplizierter wird, zunächst noch die einfach Erzeugung des Objekts
msg.dist.searchindex zur späteren Verwendung.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">1</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">3</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> msg.templates[<span style=color:#a5d6ff>&#34;search.html&#34;</span>].replace(<span style=color:#a5d6ff>&#34;&lt;!-- html head from head.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;head.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">4</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.search.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Top Navigation from navbar.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;navbar.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">5</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.search.replace(<span style=color:#a5d6ff>&#34;&lt;!-- footer navigation from footer.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;footer.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">6</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.search.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Javascript from script.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;script.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">7</span><span>msg.dist.search <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.search.replace(<span style=color:#a5d6ff>&#34;&lt;!-- PAGE TITLE --&gt;&#34;</span>,<span style=color:#a5d6ff>&#34;Suche&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">9</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-search-indexjson>create search index.json</h3><p>Um den Suchindex aufzubauen, der später eine Suche ermöglicht ohne eine Abfrage an den Server zu stellen,
verwenden ich eine for Schleife die durch alle Elemente im Array msg.posts läuft
und für jeden Beitrag einen Eintrag im Index als JSON Objekt erzeugt.
Letztlich wird der Index als Objekt msg.dist.searchindex bereit gestellt.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>var</span> alength <span style=color:#ff7b72;font-weight:700>=</span> msg.posts.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>var</span> index <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;[&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span>    index <span style=color:#ff7b72;font-weight:700>=</span> index<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`{&#34;lang&#34;:&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].language<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;,&#34;link&#34;:&#34;/posts/`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].distFilename<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;,&#34;headline&#34;:&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].title<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;,&#34;content&#34;:&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].distContent.replace(<span style=color:#79c0ff>/[^a-zA-Z0-9]/g</span>, <span style=color:#a5d6ff>&#39; &#39;</span>)<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;},`</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>index <span style=color:#ff7b72;font-weight:700>=</span> index.slice(<span style=color:#a5d6ff>0</span>, <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span>index <span style=color:#ff7b72;font-weight:700>=</span> index<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;]&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>msg.dist.searchindex <span style=color:#ff7b72;font-weight:700>=</span> index;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-sitemapxml>create sitemap.xml</h3><p>Bei der Erzeugung der Sitemap gehen wir ähnlich vor wie beim Suchindex. Anstelle einer klassischen for Schleife
verwende ich die Javascript forEach() Funktion, die im Endeffekt das gleiche bewirkt, nur etwas moderner ist.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>var</span> xml <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#a5d6ff>&lt;urlset xmlns=&#34;http://www.sitemaps.org/schemas/sitemap/0.9&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#a5d6ff>    &lt;url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#a5d6ff>        &lt;loc&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/&lt;/loc&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#a5d6ff>        &lt;priority&gt;1.00&lt;/priority&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#a5d6ff>    &lt;/url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span><span style=color:#a5d6ff>    &lt;url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#a5d6ff>        &lt;loc&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/index.html&lt;/loc&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span><span style=color:#a5d6ff>        &lt;priority&gt;0.80&lt;/priority&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span><span style=color:#a5d6ff>    &lt;/url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span><span style=color:#a5d6ff>    &lt;url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span><span style=color:#a5d6ff>        &lt;loc&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/blog.html&lt;/loc&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#a5d6ff>        &lt;priority&gt;0.80&lt;/priority&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span><span style=color:#a5d6ff>    &lt;/url&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span>msg.posts.forEach(postxml);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>xml <span style=color:#ff7b72;font-weight:700>=</span> xml <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span><span style=color:#a5d6ff>&lt;/urlset&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span>msg.dist.sitemap <span style=color:#ff7b72;font-weight:700>=</span> xml;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span><span style=color:#ff7b72>return</span> msg;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span><span style=color:#ff7b72>function</span> postxml(item) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span>     <span style=color:#ff7b72>if</span> (item.published <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#79c0ff>true</span> ) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span>        xml <span style=color:#ff7b72;font-weight:700>=</span> xml <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">27</span><span><span style=color:#a5d6ff>        &lt;url&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">28</span><span><span style=color:#a5d6ff>            &lt;loc&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/posts/`</span><span style=color:#ff7b72;font-weight:700>+</span>item.distFilename<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`.html&lt;/loc&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">29</span><span><span style=color:#a5d6ff>            &lt;priority&gt;0.64&lt;/priority&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">30</span><span><span style=color:#a5d6ff>        &lt;/url&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">31</span><span>     }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">32</span><span>}
</span></span></code></pre></div><h3 id=create-posts>create posts</h3><p>Wir haben zur im get posts Node bereits den Inhalt der einzelnen Posts im Array msg.posts
konvertiert und bereit gestellt. Jetzt wollen wir dies noch dahingehend finalisieren,
dass wir analog zu den zuvor erzeugten Dateien auch für jeden Post eine einzelne Datei erzeugen
können und lege diese wiederum als Objekt im Objekt msg.dist.posts ab.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span>msg.dist.posts <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>var</span> alength <span style=color:#ff7b72;font-weight:700>=</span> msg.posts.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#ff7b72>var</span> data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>var</span> ogmetalang <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#ff7b72>var</span> ogmeta <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#ff7b72>var</span> postdate <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>    <span style=color:#ff7b72>if</span> (msg.posts[i].language <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;de&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>       ogmetalang <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;de_DE&#34;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span>        ogmetalang <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;en_US&#34;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span>    img <span style=color:#ff7b72;font-weight:700>=</span> msg.posts[i].imgurl.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;.webp&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span>    ogmeta <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:type&#34; content=&#34;website&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:locale&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>ogmetalang<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:site_name&#34; content=&#34;niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span><span style=color:#a5d6ff>    &lt;link rel=&#34;canonical&#34; href=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/posts/`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].language<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].distFilename<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span><span style=color:#a5d6ff>    &lt;meta name=&#34;description&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].excerpt<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:title&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].title<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:description&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].excerpt<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">27</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/posts/`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].language<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].distFilename<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">28</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/media/full/`</span><span style=color:#ff7b72;font-weight:700>+</span>img<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">29</span><span><span style=color:#a5d6ff>    &lt;meta property=&#34;og:image:secure_url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/media/full/`</span><span style=color:#ff7b72;font-weight:700>+</span>img<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">30</span><span><span style=color:#a5d6ff>    &lt;meta name=&#34;twitter:card&#34; content=&#34;summary&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">31</span><span><span style=color:#a5d6ff>    &lt;meta name=&#34;twitter:description&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].excerpt<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">32</span><span><span style=color:#a5d6ff>    &lt;meta name=&#34;twitter:title&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].title<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">33</span><span><span style=color:#a5d6ff>    &lt;meta name=&#34;twitter:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/media/full/`</span><span style=color:#ff7b72;font-weight:700>+</span>img<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">34</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">35</span><span>    postdate <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;&lt;small class=&#34;c-gray pb-3&#34; id=&#34;postdate&#34;&gt;&#39;</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[i].date<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;&lt;/small&gt;&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">36</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">37</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">38</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> msg.templates[<span style=color:#a5d6ff>&#34;post.html&#34;</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">41</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- html head from head.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;head.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">42</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Top Navigation from navbar.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;navbar.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">43</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- footer navigation from footer.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;footer.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">44</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Javascript from script.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;script.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">46</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- mardown content from posts --&gt;&#34;</span>,msg.posts[i].distContent);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">47</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Post Headline --&gt;&#34;</span>, msg.posts[i].title);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">48</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- postdate --&gt;&#34;</span>, postdate);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">49</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Post Image --&gt;&#34;</span>, <span style=color:#a5d6ff>&#39;&lt;img src=&#34;/media/thumb/&#39;</span><span style=color:#ff7b72;font-weight:700>+</span>img<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;&#34; class=&#34;img-fluid mb-2&#34; alt=&#34;postImage&#34;&gt;&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">50</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- PAGE TITLE --&gt;&#34;</span>,msg.posts[i].title);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">51</span><span>    data <span style=color:#ff7b72;font-weight:700>=</span> data.replace(<span style=color:#a5d6ff>&#34;&lt;!-- meta tags --&gt;&#34;</span>,ogmeta);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">52</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">53</span><span>    msg.dist.posts[msg.posts[i].distFilename] <span style=color:#ff7b72;font-weight:700>=</span> data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">54</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">55</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">56</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=create-bloghtml>create blog.html</h3><p>Nun unser letzter vorbereitender Streich, die Erzeungung der Übersicht aller Posts im Objekt msg.dist.blog.
Es ist am Umfang der Funktion ersichtlich, dass hier etwas mehr als bei den anderen Dateien passiert.</p><p>Zuerst sammeln wir alle definierten Kategorien aus den einzelnen Posts über eine for Schleife
ein um dann doppelt vorhandene Werte wieder aus dem erzeugtem Array zu löschen.
Das brauchen wir damit die Besucher unserer Website später über Kategorien filtern können.
Jede Kategorie bekommt außerdem eine eindeutige Farbe, die einer CSS Klasse in unserem Stylesheet entspricht, zugeordnet.</p><p>Als nächstes extrahieren wir aus den Metadaten der Posts noch Titel, Kurzbeschreibung, Datum und Bild.
Während dieser for-Schleife verhindert eine if-Bedingung, dass wir unveröffentliche Posts zur Auswahl aufbereiten.</p><p>Abschließend erzeugen wir aus den ermittelten Werten den entsprechenden HTML Code, fügen die Daten der Snippets ein,
ergänzen die Meta Informationen zur Seite und schreiben das Ganze in das Objekt msg.dist.blog.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  1</span><span><span style=color:#8b949e;font-style:italic>//get categories from all posts and extract unique ones
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  2</span><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>var</span> categories <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  3</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span> ; i<span style=color:#ff7b72;font-weight:700>&lt;</span>msg.posts.length;i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  4</span><span>    <span style=color:#ff7b72>if</span> (msg.posts[i].published <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#79c0ff>true</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  5</span><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> j <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; j <span style=color:#ff7b72;font-weight:700>&lt;</span> msg.posts[i].keywords.length; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  6</span><span>            categories.push(msg.posts[i].keywords[j]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  7</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  8</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">  9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 10</span><span><span style=color:#ff7b72>var</span> uniqueCategories <span style=color:#ff7b72;font-weight:700>=</span> [...<span style=color:#ff7b72>new</span> Set(categories)];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 12</span><span><span style=color:#8b949e;font-style:italic>// define a color to stick for each category
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 13</span><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> colorcat <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 14</span><span><span style=color:#ff7b72>var</span> catcolors <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#34;green&#34;</span>, <span style=color:#a5d6ff>&#34;red&#34;</span>, <span style=color:#a5d6ff>&#34;blue&#34;</span>, <span style=color:#a5d6ff>&#34;orange&#34;</span>, <span style=color:#a5d6ff>&#34;yellow&#34;</span>, <span style=color:#a5d6ff>&#34;pink&#34;</span>, <span style=color:#a5d6ff>&#34;purple&#34;</span>,<span style=color:#a5d6ff>&#34;indigo&#34;</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 15</span><span><span style=color:#ff7b72>var</span> c<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 16</span><span> <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> key <span style=color:#ff7b72>of</span> uniqueCategories) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 17</span><span>      colorcat[key] <span style=color:#ff7b72;font-weight:700>=</span> catcolors[c];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 18</span><span>      c <span style=color:#ff7b72;font-weight:700>=</span> c<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 19</span><span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 20</span><span>       
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 22</span><span><span style=color:#8b949e;font-style:italic>//generate and set html for categorie selection
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 23</span><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>var</span> cathtml <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 24</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> k <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; k <span style=color:#ff7b72;font-weight:700>&lt;</span> uniqueCategories.length; k<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 25</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 26</span><span>    cathtml <span style=color:#ff7b72;font-weight:700>=</span> cathtml <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&lt;button data-filter=&#34;.cat-`</span><span style=color:#ff7b72;font-weight:700>+</span>uniqueCategories[k]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34; type=&#34;button&#34; 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 27</span><span><span style=color:#a5d6ff>    onclick=&#34;sort()&#34; class=&#34;btn bg-`</span> <span style=color:#ff7b72;font-weight:700>+</span> catcolors[k] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>` c-white me-2&#34;&gt;`</span> <span style=color:#ff7b72;font-weight:700>+</span> uniqueCategories[k]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&lt;/button&gt;`</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 28</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 29</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.templates[<span style=color:#a5d6ff>&#34;blog.html&#34;</span>].replace(<span style=color:#a5d6ff>&#34;&lt;!-- CATEGORIES --&gt;&#34;</span>, cathtml);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 32</span><span><span style=color:#8b949e;font-style:italic>// get card content from all posts and generate html
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 33</span><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>var</span> posthtml <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 34</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> l <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; l <span style=color:#ff7b72;font-weight:700>&lt;</span> msg.posts.length; l<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 35</span><span>    <span style=color:#ff7b72>if</span> (msg.posts[l].published <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#79c0ff>true</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 36</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 37</span><span>    <span style=color:#ff7b72>var</span> link <span style=color:#ff7b72;font-weight:700>=</span> msg.posts[l].filename.slice(<span style=color:#a5d6ff>0</span>, <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>3</span>)<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;.html&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 38</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 39</span><span>    <span style=color:#8b949e;font-style:italic>//get color for current post
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 40</span><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>var</span> postcolor <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 41</span><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> key <span style=color:#ff7b72>in</span> colorcat) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 42</span><span>        <span style=color:#ff7b72>if</span> (key <span style=color:#ff7b72;font-weight:700>==</span> msg.posts[l].keywords[<span style=color:#a5d6ff>0</span>]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 43</span><span>            postcolor <span style=color:#ff7b72;font-weight:700>=</span> colorcat[key];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 44</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 45</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 46</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 47</span><span>    imgurl <span style=color:#ff7b72;font-weight:700>=</span> msg.posts[l].imgurl.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;.webp&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 49</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 50</span><span>    posthtml <span style=color:#ff7b72;font-weight:700>=</span> posthtml <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 51</span><span><span style=color:#a5d6ff>    &lt;div class=&#34;col-sm-6 col-lg-4 my-4 filterDiv cat-`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[l].keywords[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>` lang-`</span><span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].language <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 52</span><span><span style=color:#a5d6ff>        &lt;span class=&#34;date hidden d-none&#34;&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].date <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&lt;/span&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 53</span><span><span style=color:#a5d6ff>        &lt;span class=&#34;name hidden d-none&#34;&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].title <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&lt;/span&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 54</span><span><span style=color:#a5d6ff>        &lt;div onclick=&#34;goto(&#39;`</span><span style=color:#ff7b72;font-weight:700>+</span> link<span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&#39;,&#39;blog&#39;)&#34; class=&#34;card h-100 d-flex align-items-center bo-`</span><span style=color:#ff7b72;font-weight:700>+</span>postcolor<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 55</span><span><span style=color:#a5d6ff>            &lt;div class=&#34;card-header bg-`</span><span style=color:#ff7b72;font-weight:700>+</span> postcolor <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&#34;&gt;`</span> <span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].keywords[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 56</span><span><span style=color:#a5d6ff>            &lt;div class=&#34;card-img-wrapper d-flex align-items-center&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 57</span><span><span style=color:#a5d6ff>                &lt;img src=&#34;media/thumb/`</span><span style=color:#ff7b72;font-weight:700>+</span> imgurl <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 58</span><span><span style=color:#a5d6ff>                    class=&#34;card-img-top&#34; alt=&#34;iot&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 59</span><span><span style=color:#a5d6ff>            &lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 60</span><span><span style=color:#a5d6ff>            &lt;div class=&#34;card-body&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 61</span><span><span style=color:#a5d6ff>                &lt;h5 class=&#34;card-title&#34;&gt;`</span><span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].title <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`&lt;/h5&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 62</span><span><span style=color:#a5d6ff>                &lt;p class=&#34;card-text&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 63</span><span><span style=color:#a5d6ff>                    `</span><span style=color:#ff7b72;font-weight:700>+</span> msg.posts[l].excerpt <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 64</span><span><span style=color:#a5d6ff>                &lt;/p&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 65</span><span><span style=color:#a5d6ff>            &lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 66</span><span><span style=color:#a5d6ff>            &lt;div class=&#34;card-footer small text-center c-gray pdate&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 67</span><span><span style=color:#a5d6ff>                `</span><span style=color:#ff7b72;font-weight:700>+</span>msg.posts[l].date<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 68</span><span><span style=color:#a5d6ff>            &lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 69</span><span><span style=color:#a5d6ff>        &lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 70</span><span><span style=color:#a5d6ff>    &lt;/div&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 71</span><span><span style=color:#a5d6ff>    `</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 72</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 73</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 75</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- POSTS --&gt;&#34;</span>, posthtml);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 76</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 77</span><span><span style=color:#ff7b72>var</span> ogmetalang <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;de_DE&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 78</span><span><span style=color:#ff7b72>var</span> ogmeta <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 79</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:type&#34; content=&#34;website&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 80</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:locale&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>ogmetalang<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 81</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:site_name&#34; content=&#34;niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 82</span><span><span style=color:#a5d6ff>&lt;link rel=&#34;canonical&#34; href=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/blog.html&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 83</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 84</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:title&#34; content=&#34;Projects &amp; Blog - niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 85</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 86</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/blog.html&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 87</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 88</span><span><span style=color:#a5d6ff>&lt;meta property=&#34;og:image:secure_url&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 89</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:card&#34; content=&#34;summary&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 90</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:description&#34; content=&#34;Projekte und Posts aus der Welt von IoT, Musik und mehr&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 91</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:title&#34; content=&#34;Projects &amp; Blog - niklas-stephan.de&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 92</span><span><span style=color:#a5d6ff>&lt;meta name=&#34;twitter:image&#34; content=&#34;`</span><span style=color:#ff7b72;font-weight:700>+</span>msg.baseurl<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>`/assets/img/me_logo.webp&#34;&gt;`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 93</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 94</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- meta tags --&gt;&#34;</span>,ogmeta);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 95</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- html head from head.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;head.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 96</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Top Navigation from navbar.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;navbar.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 97</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- footer navigation from footer.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;footer.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 98</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- Javascript from script.html snipppet --&gt;&#34;</span>,msg.snippets[<span style=color:#a5d6ff>&#34;script.html&#34;</span>]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 99</span><span>msg.dist.blog <span style=color:#ff7b72;font-weight:700>=</span> msg.dist.blog.replace(<span style=color:#a5d6ff>&#34;&lt;!-- PAGE TITLE --&gt;&#34;</span>,<span style=color:#a5d6ff>&#34;Projekte &amp; Blog&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">100</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">101</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=write-files>write files</h3><p>Jetzt wollen wir endlich unsere mühevoll erzeugten Objekte in msg.dist als reale Dateien festschreiben.
In unserer Funktion “write files” binden wir dafür wieder das npm modul fs-extra als fse ein.</p><p>Alle erzeugten Dateien sollem im Verzeichnis /dist/ landen. Gleichzeitig wollen wir auch alle spuren vorheriger Deployments löschen,
damit uns “Dateileichen” und ähnliche nicht zu Inkonsitenzen führen.</p><p>Das den fse Funktionen vorangestellte await stellt eine sequentielle Ausführung der einzelnen Schritte sicher, in dem es wartet bis der jeweilige Aufruf auch komplett abgeschlossen ist.
Also wird in der Funktion im ersten Schritt das Verzeichnes /dist komplett geleert und dann alle benötigten Unterordner wieder leer erstellt.</p><p>Als nächstes kopieren wir unsere Assets von /src/assets/ nach /dist/assets/ und machen das Gleiche mit der robots.txt Datei.</p><p>Anschließend schreiben wir die Inhalte der Objekte in msg.dist in die jeweilige Datei fest, um dann in einer Schleife durch
alle Posts zu gehen und diese ebenfalls in das Dateisystem zu schreiben.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>await</span> fse.emptyDir(<span style=color:#a5d6ff>&#39;/dist&#39;</span>).then(() =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span>    fse.mkdirSync(<span style=color:#a5d6ff>&#39;/dist/media&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span>    fse.mkdirSync(<span style=color:#a5d6ff>&#39;/dist/media/full&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span>    fse.mkdirSync(<span style=color:#a5d6ff>&#39;/dist/media/thumb&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span>    fse.mkdirSync(<span style=color:#a5d6ff>&#39;/dist/posts&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#ff7b72>await</span> fse.copySync(<span style=color:#a5d6ff>&#39;/src/assets/&#39;</span>, <span style=color:#a5d6ff>&#39;/dist/assets/&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span><span style=color:#ff7b72>await</span> fse.copySync(<span style=color:#a5d6ff>&#39;/src/templates/robots.txt&#39;</span>, <span style=color:#a5d6ff>&#39;/dist/robots.txt&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/index.html&#39;</span>, msg.dist.index);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/blog.html&#39;</span>, msg.dist.blog);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/404.html&#39;</span>, msg.dist.errorpage);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/privacy-policy.html&#39;</span>, msg.dist.privacy);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/search.html&#39;</span>, msg.dist.search);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/sitemap.xml&#39;</span>, msg.dist.sitemap);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span><span style=color:#ff7b72>await</span> fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/searchindex.json&#39;</span>, msg.dist.searchindex);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span><span style=color:#ff7b72>const</span> postfilefolder <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;/dist/posts/&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span><span style=color:#ff7b72>await</span> Object.entries(msg.dist.posts).forEach(item =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span>  <span style=color:#ff7b72>var</span> [key, value] <span style=color:#ff7b72;font-weight:700>=</span> item;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span>  fse.writeFileSync(postfilefolder<span style=color:#ff7b72;font-weight:700>+</span>key, value)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h4 id=convert-media-files>convert media files</h4><p>Noch etwas komplexer ist die Erzeugung der Mediendatein. Die Dateien aus dem Verzeichnis /src/media/ und einer
Unterordnerebene tiefer, wollen wir ins Speicher sparende .webp Format konvertieren und zusätzlichen
jeweils einen Thumbnail in geringerer Auflösung generieren. Außerdem wollen wir das nur Medien mit den Quellformaten
.jpg, .jpeg, .png oder .gif konvertiert werden. Alle anderen Dateien werden ohne Änderung direkt
nach /dist/media/full/ kopiert. Um uns die Arbeit zu erleichten greifen wir auf die npm Module
fs-extra als fse und sharp zurück.</p><p>Man beachte auch, das ich das await Kommando bewusst bei der Erzeugung der Dateien ausspare,
so dass die Schleifen bereits mit der nächsten Datei aus ihren Arrays starten, bevor die Schreiboperation
abgeschlossen ist. Das beschleunigt das Deployment um einen sehr großen Faktor, bei dem geringen Risiko
bzw. dem akzeptieren Umstand, dass eine Mediendatei noch nicht geschrieben/verfügbar ist,
wenn das Deplyoment abgeschlossen ist.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>var</span> srcpath <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/src/media/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>var</span> fullpath <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/dist/media/full/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span><span style=color:#ff7b72>var</span> thumbpath <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;/dist/media/thumb/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>const</span> filetypes <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#34;jpg&#34;</span>, <span style=color:#a5d6ff>&#34;jpeg&#34;</span>, <span style=color:#a5d6ff>&#34;png&#34;</span>, <span style=color:#a5d6ff>&#34;gif&#34;</span>, <span style=color:#a5d6ff>&#34;webp&#34;</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#ff7b72>const</span> mediafiles <span style=color:#ff7b72;font-weight:700>=</span> fse.readdirSync(srcpath);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span><span style=color:#ff7b72>const</span> alength <span style=color:#ff7b72;font-weight:700>=</span> mediafiles.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span><span style=color:#ff7b72>var</span> mediafile <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span><span style=color:#ff7b72>var</span> targetfile <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span><span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> i<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>&lt;</span>alength; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>    mediafile <span style=color:#ff7b72;font-weight:700>=</span> mediafiles[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span>    <span style=color:#ff7b72>if</span> (mediafile.includes(<span style=color:#a5d6ff>&#34;.&#34;</span>)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span>        targetfile <span style=color:#ff7b72;font-weight:700>=</span> mediafile.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>0</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span>        <span style=color:#ff7b72>if</span> (filetypes.includes(mediafile.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>1</span>]) ) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span>            sharp(srcpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span>            .toFile(fullpath<span style=color:#ff7b72;font-weight:700>+</span>targetfile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;.webp&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>            sharp(srcpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile).resize({ width<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>440</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">19</span><span>            .toFile(thumbpath<span style=color:#ff7b72;font-weight:700>+</span>targetfile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;.webp&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">20</span><span>        } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">21</span><span>            fse.copySync(srcpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile, fullpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">22</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">23</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">24</span><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">25</span><span>        <span style=color:#ff7b72>var</span> subsrcpath <span style=color:#ff7b72;font-weight:700>=</span> srcpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;/&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">26</span><span>        <span style=color:#ff7b72>var</span> subfullpath <span style=color:#ff7b72;font-weight:700>=</span> fullpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;/&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">27</span><span>        <span style=color:#ff7b72>var</span> subthumbpath <span style=color:#ff7b72;font-weight:700>=</span> thumbpath<span style=color:#ff7b72;font-weight:700>+</span>mediafile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;/&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">28</span><span>        <span style=color:#ff7b72>var</span> submediafiles <span style=color:#ff7b72;font-weight:700>=</span> fse.readdirSync(subsrcpath);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">29</span><span>        <span style=color:#ff7b72>var</span> blength <span style=color:#ff7b72;font-weight:700>=</span> submediafiles.length;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">30</span><span>        <span style=color:#ff7b72>await</span> fse.mkdirSync(subfullpath);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">31</span><span>        <span style=color:#ff7b72>await</span> fse.mkdirSync(subthumbpath);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">32</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">33</span><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>var</span> j<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>; j<span style=color:#ff7b72;font-weight:700>&lt;</span>blength; j<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">34</span><span>            submediafile <span style=color:#ff7b72;font-weight:700>=</span> submediafiles[j];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">35</span><span>            subtargetfile <span style=color:#ff7b72;font-weight:700>=</span> submediafile.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>0</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">36</span><span>            
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">37</span><span>            <span style=color:#ff7b72>if</span> (filetypes.includes(submediafile.split(<span style=color:#a5d6ff>&#39;.&#39;</span>)[<span style=color:#a5d6ff>1</span>]) ) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">38</span><span>                sharp(subsrcpath<span style=color:#ff7b72;font-weight:700>+</span>submediafile)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">39</span><span>                .toFile(subfullpath<span style=color:#ff7b72;font-weight:700>+</span>subtargetfile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;.webp&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">40</span><span>                
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">41</span><span>                sharp(subsrcpath<span style=color:#ff7b72;font-weight:700>+</span>submediafile).resize({ width<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>440</span> })
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">42</span><span>                .toFile(subthumbpath<span style=color:#ff7b72;font-weight:700>+</span>subtargetfile<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#39;.webp&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">43</span><span>            } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">44</span><span>                fse.copySync(subsrcpath<span style=color:#ff7b72;font-weight:700>+</span>submediafile, subfullpath<span style=color:#ff7b72;font-weight:700>+</span>submediafile)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">45</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">46</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">47</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">48</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">50</span><span><span style=color:#ff7b72>return</span> msg;
</span></span></code></pre></div><h3 id=finish>finish</h3><p>Unser Deployment nähert sich dem Ende. Wir errechnen noch die Dauer des Deployments und setzen einen Zeitstempel
um diese Informationen in der Datei /dist/deploy.log festzuhalten. Die Datei wird dann wieder mit
dem npm Modul fs-extra als fse geschrieben. Je nach Auslöser des Depyloyments, also manuell vs. webhook,
wird dann abschließnd an ein Debug Node oder an den Debug Node und einen http-out Node weitergeleitet.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 1</span><span><span style=color:#ff7b72>var</span> endtime <span style=color:#ff7b72;font-weight:700>=</span> Date.now();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 2</span><span><span style=color:#ff7b72>var</span> duration <span style=color:#ff7b72;font-weight:700>=</span> endtime<span style=color:#ff7b72;font-weight:700>-</span>msg.starttime;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 3</span><span>duration <span style=color:#ff7b72;font-weight:700>=</span> duration;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 4</span><span><span style=color:#ff7b72>let</span> yourDate <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Date()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 5</span><span><span style=color:#ff7b72>var</span> depdate <span style=color:#ff7b72;font-weight:700>=</span> yourDate.toISOString();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 7</span><span><span style=color:#ff7b72>var</span> log <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;Deployment duration: &#34;</span><span style=color:#ff7b72;font-weight:700>+</span>duration<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34; ms \n&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 8</span><span>log <span style=color:#ff7b72;font-weight:700>=</span> log<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>&#34;Deployment timestamp: &#34;</span><span style=color:#ff7b72;font-weight:700>+</span>depdate;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681"> 9</span><span>msg.statusCode <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>200</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">11</span><span>fse.writeFileSync(<span style=color:#a5d6ff>&#39;/dist/deploy.log&#39;</span>, log);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">12</span><span>msg.payload <span style=color:#ff7b72;font-weight:700>=</span> log;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">14</span><span><span style=color:#ff7b72>if</span> (msg.type <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#a5d6ff>&#34;manual&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">15</span><span>    <span style=color:#ff7b72>return</span> [msg,msg];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">16</span><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">17</span><span>    <span style=color:#ff7b72>return</span> [msg,<span style=color:#79c0ff>null</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#6e7681">18</span><span>}
</span></span></code></pre></div><h3 id=msg--http>msg & http</h3><p>Fertig! Die Beiden Nodes msg und http dienen zum sauberen Abschluss unseres Deployments.
Der “http out” Node liefert den zuvor definierten Body als Nachricht zurück an den aufrufenden Webhook.</p><p><img src=09_ncms_webhook.webp alt=Webhook></p><p>Der “msg” Debug Node zeigt uns den kompletten Inhalt des Deployments im Debugger von Node-Red an, wenn aktiviert.</p><p><img src=10_ncms_debug.webp alt=Webhook></p><p>Den kompletten Node-Red Flow könnt ihr euch auch hier herunterladen
<a href=https://niklas-stephan.de/media/orig/ncms/flow.json>https://niklas-stephan.de/media/orig/ncms/flow.json</a> (Version 0.60).</p><h2 id=fazit>Fazit</h2><p>Zugegeben, hätte ich eine Stoppuhr genutzt um aufzuzeichnen wie lange die Entwicklung von nCMS gedauert hat,
vielleicht hätte ich irgendwann abgebrochen. Aber: von Start bis Ende des Projekts,
ganz wie bei einem rundenbasierten Strategiespiel, war regelmäßig der
“nur diese eine Sache noch” Moment da. Eine Menge Spaß hat es außerdem gemacht,
mit Hilfe von Node-Red immer ausgefeiltere JavaScript Funktionen zu entwickeln.
Der fest integrierte Debugger war dabei eine fast genauso große Hilfe, wie die Möglichkeit
in Node-Red javascript Funktionen maximal einfach auf weitere node.js Module zuzugreifen.
Falls ihr mal eine ähnliches Vorhaben umsetzen möchtet, könnt ihr gerne meine Quellen Auf Github forken.</p><p>Einige verbesserungswürdige Schwachstellen gibt es natürlich auch noch.</p><p>Zum Beispiel an den Stellen, bei denen ich im Node-Red Backend auf das Frontend referenziere.
Das macht das Ganze etwas weniger flexibel, denn wenn wirklich mal jemand meine Quellen nutzen möchte,
müsste sie/er sich entsprechend noch in das Frontend einarbeiten.</p><p>Und überhaupt bin ich hier im Artikel nicht auf das HTML5 Frontend mit javascript Funktionen, CSS und HTML weiter eingegangen.</p><p>Vielleicht folgt das ein andernmal.</p><h2 id=quellen--weiterführende-links>Quellen / Weiterführende Links</h2><p>Hier nochmal alle Quellen, Links und Dateien aus dem Artikel zusammen aufgeführt:</p><ul><li>Die Quellen von NCMS bei Github: <a href=https://github.com/handtrixx/ncms>https://github.com/handtrixx/ncms</a></li><li>Der Node-Red Flow von NCMS: <a href=https://niklas-stephan.de/media/full/ncms/ncms_flow.json>https://niklas-stephan.de/media/full/ncms/ncms_flow.json</a></li><li>Das fantastastische Node-Red: <a href=https://nodered.org/>https://nodered.org/</a></li><li>Node-Red als Container bei Docker Hub: <a href=https://hub.docker.com/r/nodered/node-red>https://hub.docker.com/r/nodered/node-red</a></li><li>Ngnix Proxy Manager: <a href=https://nginxproxymanager.com/>https://nginxproxymanager.com/</a></li><li>Das famose Bootstrap HTML5 Template von Twitter: <a href=https://getbootstrap.com/>https://getbootstrap.com/</a></li><li>markdown-it – von Markup nach HTML in einfach: <a href=https://markdown-it.github.io/>https://markdown-it.github.io/</a></li><li>Dateisystemoperation in node.js mit fs-extra: <a href=https://github.com/jprichardson/node-fs-extra>https://github.com/jprichardson/node-fs-extra</a></li><li>Rasend schnelle Konvertierung von Bildern in node.js mit sharp: <a href=https://sharp.pixelplumbing.com/>https://sharp.pixelplumbing.com/</a></li></ul></div><div class=giscus></div></main><footer id=footer><img referrerpolicy=no-referrer-when-downgrade src="https://stats.handtrixxx.com/matomo.php?idsite=1&amp;rec=1" style=border:0 alt><div class=footer><div class=text-center><a href=/ aria-label="Link to Homepage"><img src=/images/favicon.png alt=Favicon width=60 height=60></a></div><div class=flex-container><div class="flex-item-3 px" style=--px-scale:2><p class=fs style=--fs-scale:0.9>Designed and built with all the ❤️ in the world by Niklas Stephan
and the help of amazing Open Source Tools.</p><p class=mt style=--mt-scale:1>2025, Niklas Stephan</p></div><div class="flex-item-3 px" style=--px-scale:2><h5>Seiten</h5><div class=fs-7><div class=n><a class=nav-link href=/>Home</a>
<a class=nav-link href=/blog>Blog</a>
<a class=nav-link href=/privacy>Datenschutz</a>
<a class=nav-link href=/imprint>Impressum</a>
<a class=nav-link href=/search>Suche</a></div></div></div><div class="flex-item-3 px" style=--px-scale:2><h5>Kontakt</h5><p class=mb style=--mb-scale:4>Niklas Stephan<br>Innovation Architect</p><a href=https://linkedin.com/in/niklas-stephan/ target=_blank class="text-decoration-none d-flex align-items-center" aria-label="Link to LinkedIn"><svg width="18" height="18" fill="currentColor" class="bi bi-linkedin me" style="--me-scale:2" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225z"/></svg>
linkedin.com/in/niklas-stephan
</a><a href=https://github.com/handtrixx target=_blank class="fs-7 text-decoration-none d-flex align-items-center" aria-label="Link to GitHub"><svg width="18" height="18" fill="currentColor" class="bi bi-github me" style="--me-scale:2" viewBox="0 0 16 16"><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.01 8.01.0 0016 8c0-4.42-3.58-8-8-8"/></svg>
https://github.com/handtrixx
</a><a href=mailto:mail@niklas-stephan.de target=_blank class="text-decoration-none d-flex align-items-center" aria-label="Link to Mail"><svg width="18" height="18" fill="currentColor" style="--me-scale:2" class="bi bi-envelope-at-fill me" viewBox="0 0 16 16"><path d="M2 2A2 2 0 00.05 3.555L8 8.414l7.95-4.859A2 2 0 0014 2zm-2 9.8V4.698l5.803 3.546zm6.761-2.97-6.57 4.026A2 2 0 002 14h6.256A4.5 4.5.0 018 12.5a4.49 4.49.0 011.606-3.446l-.367-.225L8 9.586zM16 9.671V4.697l-5.803 3.546.338.208A4.5 4.5.0 0112.5 8c1.414.0 2.675.652 3.5 1.671"/><path d="M15.834 12.244c0 1.168-.577 2.025-1.587 2.025-.503.0-1.002-.228-1.12-.648h-.043c-.118.416-.543.643-1.015.643-.77.0-1.259-.542-1.259-1.434v-.529c0-.844.481-1.4 1.26-1.4.585.0.87.333.953.63h.03v-.568h.905v2.19c0 .272.18.42.411.42.315.0.639-.415.639-1.39v-.118c0-1.277-.95-2.326-2.484-2.326h-.04c-1.582.0-2.64 1.067-2.64 2.724v.157c0 1.867 1.237 2.654 2.57 2.654h.045c.507.0.935-.07 1.18-.18v.731c-.219.1-.643.175-1.237.175h-.044C10.438 16 9 14.82 9 12.646v-.214C9 10.36 10.421 9 12.485 9h.035c2.12.0 3.314 1.43 3.314 3.034zm-4.04.21v.227c0 .586.227.8.581.8.31.0.564-.17.564-.743v-.367c0-.516-.275-.708-.572-.708-.346.0-.573.245-.573.791"/></svg>
mail@niklas-stephan.de</a></div></div></div></footer><script src="/js/scripts.min.c2fc1772ee9a696dad8b3a67f5412edd8ef91a1bc768db7aebae9c5c3a046e05.js"></script><script src=/js/post.js></script><script src=https://giscus.app/client.js data-repo=handtrixx/content_niklas-stephan.de data-repo-id=R_kgDOOFkuRg data-category=Announcements data-category-id=DIC_kwDOOFkuRs4CoSNu data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=https://niklas-stephan.de/css/giscuss.css data-lang=de data-loading=lazy crossorigin=anonymous async></script></body></html>